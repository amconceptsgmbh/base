<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Session End Logic Example</title>
</head>
<body>
  <div>
    <h1>Hello, World!</h1>
    <!-- Button to enable session end logic -->
    <p>
      This example shows you the contents of the selected part of your display.
      Click the Start Capture button to begin.
    </p>
    
    <p>
      <button id="start">Start Capture</button>&nbsp;<button id="stop">
        Stop Capture
      </button>
    </p>
    
    <video style="border: 1px solid #999; width: 98%; max-width: 860px" id="video" autoplay></video>
    <br />
    
    <strong>Log:</strong>
    <br />
    <pre style="width: 25rem; height: 15rem; border: 1px solid black; padding: 0.5rem; overflow: scroll;" id="log"></pre>
    
  </div>
  <script>
      const videoElem = document.getElementById("video");
const logElem = document.getElementById("log");
const startElem = document.getElementById("start");
const stopElem = document.getElementById("stop");

// Options for getDisplayMedia()

const displayMediaOptions = {
  video: {
    displaySurface: "window",
  },
  audio: false,
};

// Set event listeners for the start and stop buttons
startElem.addEventListener(
  "click",
  (evt) => {
    startCapture();
  },
  false,
);

stopElem.addEventListener(
  "click",
  (evt) => {
    stopCapture();
  },
  false,
);

console.log = (msg) => (logElem.textContent = `${logElem.textContent}\n${msg}`);
console.error = (msg) =>
  (logElem.textContent = `${logElem.textContent}\nError: ${msg}`);

async function startCapture() {
  logElem.textContent = "";

  try {
    videoElem.srcObject =
      await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
    dumpOptionsInfo();
  } catch (err) {
    console.error(err);
  }
}

function stopCapture(evt) {
  let tracks = videoElem.srcObject.getTracks();

  tracks.forEach((track) => track.stop());
  videoElem.srcObject = null;
}

function dumpOptionsInfo() {
  const videoTrack = videoElem.srcObject.getVideoTracks()[0];

  console.log("Track settings:");
  console.log(JSON.stringify(videoTrack.getSettings(), null, 2));
  console.log("Track constraints:");
  console.log(JSON.stringify(videoTrack.getConstraints(), null, 2));
}

  </script>

  
</body>
</html>
